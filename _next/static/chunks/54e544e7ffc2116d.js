(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71935,(e,s,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},33407,75998,e=>{"use strict";var s=e.i(4070);let a=async(e,a)=>{if(await s.supabase.from("classes").delete().match({subject_id:e,class:a.class_name}),a.ho&&a.ho.length>0){let t=a.ho.map(s=>{let[t,r]=s;return{subject_id:e,class:a.class_name,day_id:t,time_slot_id:r}}),{error:r}=await s.supabase.from("classes").insert(t);if(r)throw r}},t=async(e,a)=>{let{error:t}=await s.supabase.from("classes").delete().match({subject_id:e,class:a});if(t)throw t};e.s(["deleteClassSchedule",0,t,"saveClassSchedule",0,a],75998);let r={},c=null,i=null,o=async()=>i||(i=(async()=>{let{data:e,error:a}=await s.supabase.from("courses").select("*");if(a)throw a;return e.map(e=>({_cu:e.code,name:e.name,_da:e.dimension||[15,5],_hd:[],gid:e.id}))})()),u=async()=>(Date.now(),c||(c=(async()=>{try{let{data:e,error:a}=await s.supabase.from("subjects").select("id, semester, name, acronym, has_practical, has_theory, elective, active, course_id, courses (code)");if(a)throw a;let t=e.map(e=>e.id),{data:c,error:i}=await s.supabase.from("subject_requirements").select("subject_id, type, prerequisite_subject_id, min_credits, prerequisite_subject:subjects!fk_req_prereq_subject (acronym)").in("subject_id",t);if(i)throw i;let{data:o,error:u}=await s.supabase.from("classes").select("subject_id, class, day_id, time_slot_id").in("subject_id",t);if(u)throw u;let l=new Map;c.forEach(e=>{l.has(e.subject_id)||l.set(e.subject_id,[]),l.get(e.subject_id).push(e)});let n=new Map;o.forEach(e=>{let{subject_id:s,class:a,day_id:t,time_slot_id:r}=e;n.has(s)||n.set(s,[]);let c=n.get(s),i=c.find(e=>e.class_name===a);i||(i={class_name:a,ho:[],da:[]},c.push(i)),i.ho.push([t,r])});let d=e.map(e=>{var s,a;let t=l.get(e.id)||[],r=t.filter(e=>{var s;return"SUBJECT"===e.type&&(null==(s=e.prerequisite_subject)?void 0:s.acronym)}).map(e=>e.prerequisite_subject.acronym),c=t.find(e=>"CREDITS"===e.type),i=Array.isArray(e.courses)?null==(s=e.courses[0])?void 0:s.code:null==(a=e.courses)?void 0:a.code;return{_id:e.id,_re:e.acronym,_cu:i,_se:e.semester,_di:e.name,_ap:e.has_practical,_at:e.has_theory,_el:e.elective,_ag:e.active,_pr:r,_pr_creditos_input:c?c.min_credits:0,_classSchedules:n.get(e.id)||[]}});return r={},d.forEach(e=>{r[e._cu]||(r[e._cu]=[]),r[e._cu].push(e)}),d}catch(e){throw console.error("Erro ao carregar dados do Supabase:",e),e}finally{c=null}})())),l=async(e,t)=>{let{data:r,error:c}=await s.supabase.from("courses").select("id").eq("code",t).single();if(c||!r)throw Error("Curso ".concat(t," não encontrado no Supabase."));let i=r.id;for(let t of e){let{type:e,payload:r}=t,c=r.data;if("addDiscipline"===e){let{_di:e,_re:t,_se:r,_at:o,_ap:u,_el:l,_ag:n,_pr:d,_classSchedules:_}=c,{data:m,error:p}=await s.supabase.from("subjects").insert({name:e,acronym:t,semester:r,has_theory:o,has_practical:u,elective:l,active:n,course_id:i}).select().single();if(p)throw p;let h=m.id;if(d&&d.length>0){let{data:e,error:a}=await s.supabase.from("subjects").select("id, acronym").in("acronym",d);if(a)throw a;let t=e.map(e=>({subject_id:h,prerequisite_subject_id:e.id,type:"SUBJECT"}));await s.supabase.from("subject_requirements").insert(t)}_&&_.length>0&&await a(h,_)}else if("updateDiscipline"===e){let{_di:e,_re:a,_se:t,_at:c,_ap:o,_el:u,_ag:l,_pr:n}=r.data,d=r.id;if(!d){let{data:e}=await s.supabase.from("subjects").select("id").eq("acronym",r.reference).eq("course_id",i).single();d=e.id}if(await s.supabase.from("subjects").update({name:e,acronym:a,semester:t,has_theory:c,has_practical:o,elective:u,active:l}).eq("id",d),await s.supabase.from("subject_requirements").delete().eq("subject_id",d),n&&n.length>0){let{data:e}=await s.supabase.from("subjects").select("id, acronym").in("acronym",n),a=e.map(e=>({subject_id:d,prerequisite_subject_id:e.id,type:"SUBJECT"}));await s.supabase.from("subject_requirements").insert(a)}}else"deleteDiscipline"===e?r.id?await s.supabase.from("subjects").delete().eq("id",r.id):await s.supabase.from("subjects").delete().eq("acronym",r.reference).eq("course_id",i):("activate"===e||"deactivate"===e)&&await s.supabase.from("subjects").update({active:"activate"===e}).eq("acronym",r.reference).eq("course_id",i)}},n=async()=>{console.log("Service: loadClassesForGrid CALLED");try{let e=await u();console.log("Service: Raw subjects loaded from DB:",e?e.length:"NULL",e);let s=[];e.forEach(e=>{e._classSchedules&&e._classSchedules.length>0&&e._classSchedules.forEach(a=>{let t=a.class_name||e._di;s.push({_cu:e._cu,_se:e._se,_di:t,_re:e._re,_ap:e._ap,_at:e._at,_el:e._el,_ag:e._ag,_pr:e._pr,_ho:a.ho,_da:a.da||""})})});let a=s.filter(e=>e._se>0&&!0===e._ag).sort((e,s)=>e._se-s._se);return console.log("Service: Final processed gridData:",a.length,a),a}catch(e){throw console.error("Service CRITICAL ERROR in loadClassesForGrid:",e),e}};e.s(["clearCache",0,()=>{r={}},"commitChanges",0,l,"loadClassesForGrid",0,n,"loadCoursesRegistry",0,o,"loadDbData",0,u],33407)},56533,e=>{"use strict";var s=e.i(84409),a=e.i(24445),t=e.i(4070),r=e.i(87449);let c=(0,a.createContext)();e.s(["AuthProvider",0,e=>{let{children:i}=e,[o,u]=(0,a.useState)(null),[l,n]=(0,a.useState)(!0),d=(0,r.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("app_user");e&&u(JSON.parse(e)),n(!1)},[]);let _=async(e,s)=>{try{let{data:s,error:a}=await t.supabase.from("users").select("*").eq("username",e).single();if(a||!s)return{success:!1,error:"Usuário não encontrado."};if(s)return localStorage.setItem("app_user",JSON.stringify(s)),u(s),{success:!0};return{success:!1,error:"Senha incorreta."}}catch(e){return console.error("Erro no login:",e),{success:!1,error:e.message}}},m=async(e,s,a)=>{try{let{data:s}=await t.supabase.from("users").select("id").eq("username",e).single();if(s)return{success:!1,error:"Usuário já existe."};let{data:r,error:c}=await t.supabase.from("users").insert([{username:e,name:a,role:"user",active:!0}]).select().single();if(c)throw c;return localStorage.setItem("app_user",JSON.stringify(r)),u(r),{success:!0,user:r}}catch(e){return console.error("Erro no cadastro:",e),{success:!1,error:e.message}}},p=async()=>{localStorage.removeItem("app_user"),u(null),d.push("/")};return(0,s.jsx)(c.Provider,{value:{user:o,loading:l,login:_,register:m,logout:p,isAuthenticated:()=>!!o},children:i})},"useAuth",0,()=>{let e=(0,a.useContext)(c);if(!e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}])}]);