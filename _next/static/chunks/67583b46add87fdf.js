(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71935,(e,s,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return t}});let t=e=>{}},33407,75998,e=>{"use strict";var s=e.i(4070);let a=async(e,a)=>{if(await s.supabase.from("classes").delete().match({subject_id:e,class:a.class_name}),a.ho&&a.ho.length>0){let t=a.ho.map(s=>{let[t,r]=s;return{subject_id:e,class:a.class_name,day_id:t,time_slot_id:r}}),{error:r}=await s.supabase.from("classes").insert(t);if(r)throw r}},t=async(e,a)=>{let{error:t}=await s.supabase.from("classes").delete().match({subject_id:e,class:a});if(t)throw t};e.s(["deleteClassSchedule",0,t,"saveClassSchedule",0,a],75998);let r={},i=null,c=null,o=async()=>c||(c=(async()=>{let{data:e,error:a}=await s.supabase.from("courses").select("*");if(a)throw a;return e.map(e=>({_cu:e.code,name:e.name,_da:e.dimension||[15,5],_hd:[],gid:e.id}))})()),u=async()=>(Date.now(),i||(i=(async()=>{try{let{data:e,error:a}=await s.supabase.from("subjects").select("id, semester, name, acronym, has_practical, has_theory, elective, active, course_id, courses (code)");if(a)throw a;let t=e.map(e=>e.id),{data:i,error:c}=await s.supabase.from("subject_requirements").select("subject_id, type, prerequisite_subject_id, min_credits, prerequisite_subject:subjects!fk_req_prereq_subject (acronym)").in("subject_id",t);if(c)throw c;let{data:o,error:u}=await s.supabase.from("classes").select("subject_id, class, day_id, time_slot_id").in("subject_id",t);if(u)throw u;let l=new Map;i.forEach(e=>{l.has(e.subject_id)||l.set(e.subject_id,[]),l.get(e.subject_id).push(e)});let d=new Map;o.forEach(e=>{let{subject_id:s,class:a,day_id:t,time_slot_id:r}=e;d.has(s)||d.set(s,[]);let i=d.get(s),c=i.find(e=>e.class_name===a);c||(c={class_name:a,ho:[],da:[]},i.push(c)),c.ho.push([t,r])});let n=e.map(e=>{var s,a;let t=l.get(e.id)||[],r=t.filter(e=>{var s;return"SUBJECT"===e.type&&(null==(s=e.prerequisite_subject)?void 0:s.acronym)}).map(e=>e.prerequisite_subject.acronym),i=t.find(e=>"CREDITS"===e.type),c=Array.isArray(e.courses)?null==(s=e.courses[0])?void 0:s.code:null==(a=e.courses)?void 0:a.code;return{_id:e.id,_re:e.acronym,_cu:c,_se:e.semester,_di:e.name,_ap:e.has_practical,_at:e.has_theory,_el:e.elective,_ag:e.active,_pr:r,_pr_creditos_input:i?i.min_credits:0,_classSchedules:d.get(e.id)||[]}});return r={},n.forEach(e=>{r[e._cu]||(r[e._cu]=[]),r[e._cu].push(e)}),n}catch(e){throw console.error("Erro ao carregar dados do Supabase:",e),e}finally{i=null}})())),l=async(e,t)=>{let{data:r,error:i}=await s.supabase.from("courses").select("id").eq("code",t).single();if(i||!r)throw Error("Curso ".concat(t," nÃ£o encontrado no Supabase."));let c=r.id;for(let t of e){let{type:e,payload:r}=t,i=r.data;if("addDiscipline"===e){let{_di:e,_re:t,_se:r,_at:o,_ap:u,_el:l,_ag:d,_pr:n,_classSchedules:_}=i,{data:p,error:h}=await s.supabase.from("subjects").insert({name:e,acronym:t,semester:r,has_theory:o,has_practical:u,elective:l,active:d,course_id:c}).select().single();if(h)throw h;let m=p.id;if(n&&n.length>0){let{data:e,error:a}=await s.supabase.from("subjects").select("id, acronym").in("acronym",n);if(a)throw a;let t=e.map(e=>({subject_id:m,prerequisite_subject_id:e.id,type:"SUBJECT"}));await s.supabase.from("subject_requirements").insert(t)}_&&_.length>0&&await a(m,_)}else if("updateDiscipline"===e){let{_di:e,_re:a,_se:t,_at:i,_ap:o,_el:u,_ag:l,_pr:d}=r.data,n=r.id;if(!n){let{data:e}=await s.supabase.from("subjects").select("id").eq("acronym",r.reference).eq("course_id",c).single();n=e.id}if(await s.supabase.from("subjects").update({name:e,acronym:a,semester:t,has_theory:i,has_practical:o,elective:u,active:l}).eq("id",n),await s.supabase.from("subject_requirements").delete().eq("subject_id",n),d&&d.length>0){let{data:e}=await s.supabase.from("subjects").select("id, acronym").in("acronym",d),a=e.map(e=>({subject_id:n,prerequisite_subject_id:e.id,type:"SUBJECT"}));await s.supabase.from("subject_requirements").insert(a)}}else"deleteDiscipline"===e?r.id?await s.supabase.from("subjects").delete().eq("id",r.id):await s.supabase.from("subjects").delete().eq("acronym",r.reference).eq("course_id",c):("activate"===e||"deactivate"===e)&&await s.supabase.from("subjects").update({active:"activate"===e}).eq("acronym",r.reference).eq("course_id",c)}},d=async()=>{console.log("Service: loadClassesForGrid CALLED");try{let e=await u();console.log("Service: Raw subjects loaded from DB:",e?e.length:"NULL",e);let s=[];e.forEach(e=>{e._classSchedules&&e._classSchedules.length>0&&e._classSchedules.forEach(a=>{let t=a.class_name||e._di;s.push({_cu:e._cu,_se:e._se,_di:t,_re:e._re,_ap:e._ap,_at:e._at,_el:e._el,_ag:e._ag,_pr:e._pr,_ho:a.ho,_da:a.da||""})})});let a=s.filter(e=>e._se>0&&!0===e._ag).sort((e,s)=>e._se-s._se);return console.log("Service: Final processed gridData:",a.length,a),a}catch(e){throw console.error("Service CRITICAL ERROR in loadClassesForGrid:",e),e}};e.s(["clearCache",0,()=>{r={}},"commitChanges",0,l,"loadClassesForGrid",0,d,"loadCoursesRegistry",0,o,"loadDbData",0,u],33407)},56533,e=>{"use strict";var s=e.i(84409),a=e.i(24445),t=e.i(4070),r=e.i(87449);let i=(0,a.createContext)();e.s(["AuthProvider",0,e=>{let{children:c}=e,[o,u]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),n=(0,r.useRouter)();(0,a.useEffect)(()=>{(async()=>{let{data:{session:e}}=await t.supabase.auth.getSession();if(e){u(e.user);let{data:s}=await t.supabase.from("profiles").select("is_paid").eq("id",e.user.id).single();s&&(e.user.is_paid=s.is_paid,u(e.user))}d(!1)})();let{data:{subscription:e}}=t.supabase.auth.onAuthStateChange(async(e,s)=>{if(console.log("Auth State Changed:",e),"SIGNED_IN"===e||"TOKEN_REFRESHED"===e){let{data:e}=await t.supabase.from("profiles").select("is_paid").eq("id",s.user.id).single();e&&(s.user.is_paid=e.is_paid),u(s.user)}else"SIGNED_OUT"===e&&(u(null),n.push("/"))});return()=>{e.unsubscribe()}},[n]);let _=async(e,s)=>{try{let{data:a,error:r}=await t.supabase.auth.signInWithPassword({email:e,password:s});if(r)throw r;return{success:!0}}catch(e){return console.error("Erro no login Supabase:",e),{success:!1,error:e.message}}},p=async(e,s,a)=>{try{let{data:r,error:i}=await t.supabase.auth.signUp({email:e,password:s,options:{data:{full_name:a}}});if(i)throw i;return{success:!0,user:r.user,session:r.session}}catch(e){return console.error("Erro no cadastro Supabase:",e),{success:!1,error:e.message}}},h=async()=>{await t.supabase.auth.signOut()};return(0,s.jsx)(i.Provider,{value:{user:o,loading:l,login:_,register:p,logout:h,isAuthenticated:()=>!!o},children:c})},"useAuth",0,()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}])}]);